<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalender mit Ereignissen</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, onValue, push, update } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAbvF26pw-NVQGW1lMmNCW3avQllWXylpY",
      authDomain: "kalender-3da21.firebaseapp.com",
      projectId: "kalender-3da21",
      storageBucket: "kalender-3da21.appspot.com",
      messagingSenderId: "731037868090",
      appId: "1:731037868090:web:02ac820fbb8bb9abd21503",
      measurementId: "G-DTYRKLSD4L",
      databaseURL: "https://kalender-3da21-default-rtdb.europe-west1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const today = new Date();
    const currentMonth = today.getMonth();
    const currentYear = today.getFullYear();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    const firstDay = new Date(currentYear, currentMonth, 1).getDay();

    let events = {};

    function loadEvents() {
      const eventsRef = ref(db, 'events');
      onValue(eventsRef, (snapshot) => {
        events = snapshot.val() || {};
        renderCalendar();
      });
    }

    function renderCalendar() {
      let calendarHTML = '<table id="calendar">';
      calendarHTML += '<tr class="calendar-header">';
      calendarHTML += '<th>So</th><th>Mo</th><th>Di</th><th>Mi</th><th>Do</th><th>Fr</th><th>Sa</th>';
      calendarHTML += '</tr><tr>';

      for (let i = 0; i < firstDay; i++) {
        calendarHTML += '<td></td>';
      }

      for (let i = 1; i <= daysInMonth; i++) {
        const hasEvent = events[i] ? 'has-event' : '';
        calendarHTML += `<td class="calendar-day ${hasEvent}" onclick="showEvents(${i})">${i}</td>`;
        if ((i + firstDay) % 7 === 0) {
          calendarHTML += '</tr><tr>';
        }
      }

      calendarHTML += '</tr></table>';
      document.getElementById('calendar').innerHTML = calendarHTML;
    }

    window.showEvents = function(day) {
      const eintraege = events[day];
      if (eintraege) {
        alert(`Termine am ${day}.: ${eintraege.join(', ')}`);
      } else {
        alert("Keine Termine für diesen Tag.");
      }
    };

    window.addEventListener('DOMContentLoaded', () => {
      loadEvents();

      document.getElementById("addEventForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const day = document.getElementById("day").value;
        const text = document.getElementById("eventText").value;

        const refPath = ref(db, `events/${day}`);
        const existingEvents = events[day] || [];
        existingEvents.push(text);

        update(ref(db), {
          [`events/${day}`]: existingEvents
        });

        document.getElementById("addEventForm").reset();
      });
    });
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }

    .calendar-container {
      width: 90%;
      max-width: 800px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    #calendar {
      width: 100%;
      border-collapse: collapse;
    }

    .calendar-header th {
      background-color: #eee;
      padding: 10px;
    }

    .calendar-day {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
      cursor: pointer;
    }

    .calendar-day.has-event {
      background-color: #4CAF50;
      color: white;
    }

    form {
      margin-top: 20px;
    }

    input, button {
      padding: 8px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="calendar-container">
    <h1>Kalender</h1>
    <div id="calendar">Lade Kalender...</div>

    <form id="addEventForm">
      <h3>Neuen Termin hinzufügen</h3>
      <label>Tag: <input type="number" id="day" min="1" max="31" required /></label>
      <label>Text: <input type="text" id="eventText" required /></label>
      <button type="submit">Hinzufügen</button>
    </form>
  </div>
</body>
</html>
