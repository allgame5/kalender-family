<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interaktiver Kalender</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fc;
      margin: 0;
      padding: 0;
    }

    .calendar {
      max-width: 1000px;
      margin: 20px auto;
      padding: 30px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .header button {
      background: #3f51b5;
      color: white;
      border: none;
      padding: 10px 15px;
      font-size: 18px;
      border-radius: 5px;
      cursor: pointer;
    }

    .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
    }

    .day {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 8px;
      background: #fff;
      min-height: 100px;
      position: relative;
    }

    .day:hover {
      background-color: #f0f0f0;
    }

    .event {
      background: #3f51b5;
      color: #fff;
      padding: 5px;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 5px;
      cursor: move;
    }

    .multi-day {
      background: #4caf50 !important;
    }

    .event:hover {
      background-color: #303f9f;
    }

    .day-details {
      margin-top: 20px;
      padding: 20px;
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    input, label {
      display: block;
      width: 100%;
      margin-top: 10px;
    }

    input[type="text"], input[type="time"], input[type="date"] {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 10px;
      padding: 10px 20px;
      background-color: #3f51b5;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #303f9f;
    }

    .event-controls {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 12px;
    }

    .event-controls span {
      cursor: pointer;
      color: white;
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <div class="calendar" id="calendarContainer" style="display: none;">
    <div class="header">
      <button onclick="changeMonth(-1)">‚ùÆ</button>
      <h2 id="monthYear">Mai 2025</h2>
      <button onclick="changeMonth(1)">‚ùØ</button>
    </div>
    <div class="days" id="daysContainer"><div></div><div></div><div></div><div class="day"><strong>1 Do</strong></div><div class="day"><strong>2 Fr</strong></div><div class="day"><strong>3 Sa</strong><div class="event" draggable="true">Cranio Oma (10:00-11:30)</div></div><div class="day"><strong>4 So</strong><div class="event" draggable="true">Cranio Oma (10:00-11:30)</div><div class="event" draggable="true">Cranio Frau Hofer (16:30-18:00)</div></div><div class="day"><strong>5 Mo</strong></div><div class="day"><strong>6 Di</strong></div><div class="day"><strong>7 Mi</strong></div><div class="day"><strong>8 Do</strong></div><div class="day"><strong>9 Fr</strong></div><div class="day"><strong>10 Sa</strong></div><div class="day"><strong>11 So</strong></div><div class="day"><strong>12 Mo</strong></div><div class="day"><strong>13 Di</strong></div><div class="day"><strong>14 Mi</strong></div><div class="day"><strong>15 Do</strong></div><div class="day"><strong>16 Fr</strong></div><div class="day"><strong>17 Sa</strong></div><div class="day"><strong>18 So</strong></div><div class="day"><strong>19 Mo</strong></div><div class="day"><strong>20 Di</strong></div><div class="day"><strong>21 Mi</strong></div><div class="day"><strong>22 Do</strong></div><div class="day"><strong>23 Fr</strong></div><div class="day"><strong>24 Sa</strong></div><div class="day"><strong>25 So</strong></div><div class="day"><strong>26 Mo</strong></div><div class="day"><strong>27 Di</strong></div><div class="day"><strong>28 Mi</strong></div><div class="day"><strong>29 Do</strong></div><div class="day"><strong>30 Fr</strong></div><div class="day"><strong>31 Sa</strong></div></div>
    <div class="day-details" id="dayDetails" style="display: block;"><h3>Termine am 2025-05-03</h3><div id="eventList"><div>Cranio Oma (10:00-11:30)  
              <div class="event-controls">
                <span onclick="editEvent('2025-05-03','-OPFUzO6vjc1eFsDkROD')">‚úèÔ∏è</span>
                <span onclick="deleteEvent('2025-05-03','-OPFUzO6vjc1eFsDkROD')">üóëÔ∏è</span>
              </div></div></div><hr>
        <label>Titel</label><input id="titleInput" type="text">
        <label>Von</label><input id="fromInput" type="time">
        <label>Bis</label><input id="toInput" type="time">
        <label>Ende (optional)</label><input id="endDateInput" type="date">
        <label><input id="notifyInput" type="checkbox"> Benachrichtigen</label>
        <button onclick="addEvent('2025-05-03')">Speichern</button></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAbvF26pw-NVQGW1lMmNCW3avQllWXylpY",
      authDomain: "kalender-3da21.firebaseapp.com",
      projectId: "kalender-3da21",
      storageBucket: "kalender-3da21.appspot.com",
      messagingSenderId: "731037868090",
      appId: "1:731037868090:web:02ac820fbb8bb9abd21503",
      measurementId: "G-DTYRKLSD4L"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentDate = new Date();
    const daysContainer = document.getElementById("daysContainer");
    const monthYear = document.getElementById("monthYear");
    const dayDetails = document.getElementById("dayDetails");
    const calendarContainer = document.getElementById("calendarContainer");

    window.onload = function() {
      auth.onAuthStateChanged(user => {
        if (!user) {
          // Wenn der Benutzer nicht eingeloggt ist, weiter zur Login-Seite
          window.location.href = "login.html";
        } else {
          // Wenn der Benutzer eingeloggt ist, Kalender anzeigen
          calendarContainer.style.display = "block";
          renderCalendar();
        }
      });
    }

    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      renderCalendar();
    }

    function renderCalendar() {
      daysContainer.innerHTML = "";
      dayDetails.style.display = "none";

      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      monthYear.textContent = currentDate.toLocaleString("de-DE", { month: "long", year: "numeric" });

      for (let i = 0; i < (firstDay === 0 ? 6 : firstDay - 1); i++) {
        daysContainer.innerHTML += `<div></div>`;
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const fullDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dateObj = new Date(year, month, day);
        const dayName = dateObj.toLocaleDateString("de-DE", { weekday: "short" });
        const dayDiv = document.createElement("div");
        dayDiv.className = "day";
        dayDiv.innerHTML = `<strong>${day} ${dayName}</strong>`;
        dayDiv.ondrop = (e) => dropEvent(e, fullDate);
        dayDiv.ondragover = (e) => e.preventDefault();
        dayDiv.addEventListener("click", () => showDayDetails(fullDate));
        daysContainer.appendChild(dayDiv);
      }
    }

    function showDayDetails(date) {
      dayDetails.style.display = "block";
      document.getElementById("dayDetails").innerHTML = `<h3>Termine am ${date}</h3><div id="eventList"></div>`;
      loadEvents(date);
    }

    function loadEvents(date) {
      db.ref("events/" + date).once("value", (snapshot) => {
        const eventList = snapshot.val();
        const eventListDiv = document.getElementById("eventList");
        eventListDiv.innerHTML = "";
        for (const eventId in eventList) {
          const event = eventList[eventId];
          const eventDiv = document.createElement("div");
          eventDiv.textContent = `${event.title} (${event.start} - ${event.end})`;
          eventListDiv.appendChild(eventDiv);
        }
      });
    }

    function addEvent(date) {
      const title = document.getElementById("titleInput").value;
      const from = document.getElementById("fromInput").value;
      const to = document.getElementById("toInput").value;
      const endDate = document.getElementById("endDateInput").value;
      const notify = document.getElementById("notifyInput").checked;

      const event = {
        title: title,
        start: from,
        end: to,
        notify: notify
      };

      db.ref("events/" + date).push(event);
      loadEvents(date);
    }
  </script>
</body>
</html>
